<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìœ íŠœë¸Œ ì˜ìƒ ì •ë¦¬ ë„êµ¬ v13 (Zero Summary)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%); }
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #1e293b; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #64748b; }
        .modal-overlay { background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(4px); }
        .file-drop-zone { border: 2px dashed #475569; transition: all 0.3s ease; }
        .file-drop-zone:hover, .file-drop-zone.drag-over { border-color: #3b82f6; background: rgba(59, 130, 246, 0.1); }
        
        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .claude-btn { background: linear-gradient(135deg, #ea580c 0%, #dc2626 100%); }
        .claude-btn:hover { background: linear-gradient(135deg, #f97316 0%, #ef4444 100%); }
        .gemini-btn { background: linear-gradient(135deg, #2563eb 0%, #7c3aed 100%); box-shadow: 0 0 15px rgba(37, 99, 235, 0.5); }
        .gemini-btn:hover { background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%); box-shadow: 0 0 20px rgba(37, 99, 235, 0.7); }
        
        .toggle-checkbox:checked { right: 0; border-color: #3b82f6; }
        .toggle-checkbox:checked + .toggle-label { background-color: #3b82f6; }
        
        .step-indicator { width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; border-radius: 50%; font-size: 12px; font-weight: bold; }
        .service-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
        
        /* ë¹„ìš°ê¸° ë²„íŠ¼ ê°•ì¡° ìŠ¤íƒ€ì¼ */
        .clear-btn { 
            background: rgba(239, 68, 68, 0.15); 
            color: #fca5a5; 
            border: 1px solid rgba(239, 68, 68, 0.3); 
            transition: all 0.2s;
        }
        .clear-btn:hover { 
            background: rgba(239, 68, 68, 0.3); 
            color: #ffffff;
            border-color: #ef4444;
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-6">
    <div class="max-w-6xl mx-auto">
        <div class="flex flex-col md:flex-row items-center justify-between mb-6 gap-4">
            <div class="text-center md:text-left">
                <h1 class="text-2xl md:text-3xl font-bold text-white mb-1">
                    ğŸ“º ìœ íŠœë¸Œ ì˜ìƒ ì •ë¦¬ ë„êµ¬ v13
                </h1>
                <p class="text-slate-400 text-sm">
                    í•¨ì¶• ì—†ëŠ” 100% ì „ì²´ ê¸°ë¡ & HTML ìŠ¤íƒ€ì¼ë§
                </p>
            </div>
            <div class="bg-slate-800 p-3 rounded-xl border border-slate-700 flex items-center gap-3">
                <span class="text-sm font-medium text-slate-300">ğŸ’ ì œë¯¸ë‚˜ì´(Gemini) ëª¨ë“œ</span>
                <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                    <input type="checkbox" name="toggle" id="geminiToggle" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer transition-all duration-300 left-0 peer checked:left-4"/>
                    <label for="geminiToggle" class="toggle-label block overflow-hidden h-6 rounded-full bg-slate-600 cursor-pointer peer-checked:bg-blue-600 transition-colors duration-300"></label>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 md:gap-6">
            <div class="space-y-4">
                <div class="bg-slate-800 rounded-xl p-4 md:p-5 border border-slate-700">
                    <label class="block text-sm font-medium text-slate-300 mb-2">ğŸ”— ìœ íŠœë¸Œ ë§í¬</label>
                    <input type="text" id="youtubeUrl" placeholder="https://www.youtube.com/watch?v=..." class="w-full px-4 py-3 bg-slate-900 border border-slate-600 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"/>
                    <p id="loadingMsg" class="text-blue-400 text-sm mt-2 hidden">â³ ì˜ìƒ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</p>
                    <p id="errorMsg" class="text-red-400 text-sm mt-2 hidden"></p>
                    <p id="successMsg" class="text-green-400 text-sm mt-2 hidden"></p>
                </div>

                <div class="bg-slate-800 rounded-xl p-4 md:p-5 border border-slate-700">
                    <label class="block text-sm font-medium text-slate-300 mb-2">ğŸ“Œ ì˜ìƒ ì œëª©</label>
                    <input type="text" id="videoTitle" placeholder="ì˜ìƒ ì œëª© ìë™ ì…ë ¥" class="w-full px-4 py-3 bg-slate-900 border border-slate-600 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500"/>
                </div>

                <div class="bg-slate-800 rounded-xl p-4 md:p-5 border border-slate-700">
                    <label class="block text-sm font-medium text-slate-300 mb-3">ğŸ¯ ê¸°ë¡(ì •ë¦¬) ëª¨ë“œ</label>
                    <div class="grid grid-cols-3 gap-2">
                        <button onclick="setAnalysisMode('auto')" id="modeAuto" class="mode-btn px-3 py-2.5 bg-gradient-to-r from-purple-600 to-blue-600 text-white text-xs font-medium rounded-lg ring-2 ring-purple-400 ring-offset-2 ring-offset-slate-800"><span class="block text-base mb-0.5">ğŸ¤–</span> ìë™ (ì „ì²´ê¸°ë¡)</button>
                        <button onclick="setAnalysisMode('finance')" id="modeFinance" class="mode-btn px-3 py-2.5 bg-slate-700 hover:bg-slate-600 text-white text-xs font-medium rounded-lg"><span class="block text-base mb-0.5">ğŸ“ˆ</span> ê²½ì œ/íˆ¬ì (ìƒì„¸)</button>
                        <button onclick="setAnalysisMode('general')" id="modeGeneral" class="mode-btn px-3 py-2.5 bg-slate-700 hover:bg-slate-600 text-white text-xs font-medium rounded-lg"><span class="block text-base mb-0.5">ğŸ“š</span> ì¼ë°˜ (ìƒì„¸)</button>
                    </div>
                </div>

                <div class="bg-slate-800 rounded-xl p-4 md:p-5 border border-slate-700">
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">ğŸ“ íŒŒì¼ í˜•ì‹ (HTML ì¶”ì²œ)</label>
                            <div class="grid grid-cols-4 gap-1.5">
                                <button onclick="setFileFormat('auto')" id="formatAuto" class="format-btn px-2 py-2 bg-slate-700 hover:bg-slate-600 text-white text-xs font-medium rounded-lg">ğŸ¤–<span class="text-[10px] block">ìë™</span></button>
                                <button onclick="setFileFormat('docx')" id="formatDocx" class="format-btn px-2 py-2 bg-slate-700 hover:bg-slate-600 text-white text-xs font-medium rounded-lg">ğŸ“<span class="text-[10px] block">.docx</span></button>
                                <button onclick="setFileFormat('md')" id="formatMd" class="format-btn px-2 py-2 bg-slate-700 hover:bg-slate-600 text-white text-xs font-medium rounded-lg">ğŸ“‹<span class="text-[10px] block">.md</span></button>
                                <button onclick="setFileFormat('html')" id="formatHtml" class="format-btn px-2 py-2 bg-gradient-to-r from-orange-600 to-red-600 text-white text-xs font-medium rounded-lg ring-2 ring-orange-400 ring-offset-1 ring-offset-slate-800">ğŸŒ<span class="text-[10px] block">.html</span></button>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">ğŸ“ ë¬¸ì„œ ë ˆì´ì•„ì›ƒ</label>
                            <div class="grid grid-cols-3 gap-1.5">
                                <button onclick="setDocLayout('auto')" id="layoutAuto" class="layout-btn px-2 py-2 bg-gradient-to-r from-teal-600 to-cyan-600 text-white text-xs font-medium rounded-lg ring-2 ring-teal-400 ring-offset-1 ring-offset-slate-800">ğŸ¤–<span class="text-[10px] block">ìë™</span></button>
                                <button onclick="setDocLayout('pc')" id="layoutPc" class="layout-btn px-2 py-2 bg-slate-700 hover:bg-slate-600 text-white text-xs font-medium rounded-lg">ğŸ–¥ï¸<span class="text-[10px] block">PC</span></button>
                                <button onclick="setDocLayout('mobile')" id="layoutMobile" class="layout-btn px-2 py-2 bg-slate-700 hover:bg-slate-600 text-white text-xs font-medium rounded-lg">ğŸ“±<span class="text-[10px] block">Mobile</span></button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-slate-800 rounded-xl p-4 md:p-5 border border-slate-700">
                    <div class="flex items-center justify-between mb-2">
                        <label class="block text-sm font-medium text-slate-300">ğŸ“ ìë§‰ ë‚´ìš©</label>
                        <div class="flex gap-2">
                            <button onclick="openTranscriptModal()" id="fetchTranscriptBtn" class="px-3 py-1.5 bg-green-600 hover:bg-green-700 text-white text-xs font-medium rounded-lg transition-colors flex items-center gap-1"><span>ğŸ“¥</span> ìë§‰ ê°€ì ¸ì˜¤ê¸°</button>
                            <button onclick="clearTranscript()" class="px-3 py-1.5 bg-slate-600 hover:bg-slate-700 text-white text-xs font-medium rounded-lg transition-colors">ì§€ìš°ê¸°</button>
                        </div>
                    </div>
                    
                    <div id="fileDropZone" class="file-drop-zone rounded-lg p-3 mb-3 text-center cursor-pointer" onclick="document.getElementById('fileInput').click()">
                        <input type="file" id="fileInput" accept=".txt,.srt,.vtt,.sub,.ass,.ssa,.sbv,.json" class="hidden" onchange="handleFileUpload(event)"/>
                        <div class="text-slate-400 text-sm"><span class="text-xl">ğŸ“</span><span class="ml-2">ìë§‰ íŒŒì¼ ë“œë˜ê·¸ ë˜ëŠ” í´ë¦­</span></div>
                    </div>
                    <p id="fileInfo" class="text-green-400 text-xs mb-2 hidden"></p>
                    <textarea id="transcript" placeholder="ìœ íŠœë¸Œ ìë§‰ì„ ì—¬ê¸°ì— ë¶™ì—¬ë„£ê±°ë‚˜..." rows="6" class="w-full px-4 py-3 bg-slate-900 border border-slate-600 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none custom-scrollbar"></textarea>
                    <p id="transcriptInfo" class="text-slate-500 text-xs mt-2"></p>
                    <div id="geminiHint" class="hidden mt-3 p-2 bg-blue-900/30 border border-blue-700/50 rounded-lg text-xs text-blue-300">
                        <span class="font-bold">âœ¨ Gemini ëª¨ë“œ:</span> ìë§‰ ì—†ì´ë„ ì˜ìƒ ì§ì ‘ ë¶„ì„ ê°€ëŠ¥ (YouTube í™•ì¥ í”„ë¡œê·¸ë¨ í•„ìš”)
                    </div>
                </div>

                <div class="space-y-3">
                    <button onclick="runAnalysis()" id="runBtn" class="w-full px-6 py-4 claude-btn text-white font-bold rounded-xl transition-all text-lg flex items-center justify-center gap-2">ğŸš€ Claudeì—ì„œ ë¶„ì„ ì‹¤í–‰</button>
                    <div class="flex gap-2">
                        <button onclick="previewHtml()" class="flex-1 px-4 py-2.5 bg-purple-600 hover:bg-purple-700 text-white font-medium rounded-lg text-sm flex items-center justify-center gap-1">ğŸ‘ï¸ HTML ë¯¸ë¦¬ë³´ê¸°</button>
                        <button onclick="downloadHtml()" class="flex-1 px-4 py-2.5 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg text-sm flex items-center justify-center gap-1">ğŸ’¾ .html ë‹¤ìš´ë¡œë“œ</button>
                        <button onclick="resetAll()" class="px-4 py-2.5 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg text-sm">ğŸ”„ ë¦¬ì…‹</button>
                    </div>
                </div>
            </div>

            <div class="bg-slate-800 rounded-xl border border-slate-700 flex flex-col h-fit lg:h-auto">
                <div class="flex items-center justify-between px-4 md:px-5 py-3 border-b border-slate-700">
                    <h2 class="text-sm font-medium text-slate-300">ğŸ“‹ ìƒì„±ëœ í”„ë¡¬í”„íŠ¸ / ê²°ê³¼</h2>
                    <div class="flex items-center gap-2">
                        <button onclick="clearOutput()" class="px-3 py-1.5 clear-btn text-xs font-bold rounded-lg flex items-center gap-1" title="ê²°ê³¼ ë‚´ìš© ëª¨ë‘ ì§€ìš°ê¸°">
                            ğŸ—‘ï¸ ì „ì²´ ë¹„ìš°ê¸°
                        </button>
                        <span id="previewBadge" class="px-2 py-1 bg-slate-700 text-slate-400 text-xs rounded hidden">ëŒ€ê¸°ì¤‘</span>
                    </div>
                </div>
                <div class="px-4 pt-2 pb-0">
                   <p class="text-xs text-slate-400">ğŸ‘‡ [ë¶„ì„ ì‹¤í–‰] í›„ AIê°€ ì‘ì„±í•´ì¤€ HTML ì½”ë“œë¥¼ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.</p>
                </div>
                <div class="flex-1 p-4 md:p-5 overflow-auto custom-scrollbar" style="max-height: 500px;">
                    <textarea id="output" class="w-full h-full bg-transparent text-sm text-slate-300 font-mono leading-relaxed focus:outline-none resize-none" placeholder="í”„ë¡¬í”„íŠ¸ê°€ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤.&#13;&#10;AIê°€ ì‘ì„±í•œ ì½”ë“œë¥¼ ì—¬ê¸°ì— ë¶™ì—¬ë„£ì–´ í™•ì¸í•˜ì„¸ìš”."></textarea>
                </div>
            </div>
        </div>
    </div>

    <div id="transcriptModal" class="fixed inset-0 modal-overlay z-50 hidden flex items-center justify-center p-4">
        <div class="bg-slate-800 rounded-2xl border border-slate-700 max-w-3xl w-full max-h-[90vh] overflow-hidden">
            <div class="flex items-center justify-between px-6 py-4 border-b border-slate-700">
                <h3 class="text-lg font-semibold text-white">ğŸ“¥ ìë§‰ ê°€ì ¸ì˜¤ê¸°</h3>
                <button onclick="closeTranscriptModal()" class="text-slate-400 hover:text-white text-2xl">&times;</button>
            </div>
            <div class="p-6 overflow-auto custom-scrollbar" style="max-height: calc(90vh - 140px);">
                <div class="mb-6"><div class="flex items-center gap-2 mb-3"><span class="step-indicator bg-orange-600 text-white">1</span><h4 class="text-sm font-medium text-orange-400">íŒŒì¼ ì—…ë¡œë“œ</h4></div><div class="bg-slate-900 rounded-lg p-4 border border-slate-600"><div id="modalFileDropZone" class="file-drop-zone rounded-lg p-6 text-center cursor-pointer" onclick="document.getElementById('modalFileInput').click()"><input type="file" id="modalFileInput" accept=".txt,.srt,.vtt,.sub,.ass,.ssa,.sbv,.json" class="hidden" onchange="handleModalFileUpload(event)"/><div class="text-slate-400"><span class="text-3xl">ğŸ“</span><p class="mt-2 font-medium">ìë§‰ íŒŒì¼ ë“œë˜ê·¸/í´ë¦­</p></div></div></div></div>
                <div class="mb-6"><div class="flex items-center gap-2 mb-3"><span class="step-indicator bg-blue-600 text-white">2</span><h4 class="text-sm font-medium text-blue-400">ì™¸ë¶€ ì„œë¹„ìŠ¤</h4></div><div class="bg-slate-900 rounded-lg p-4 border border-slate-600"><div class="grid grid-cols-2 sm:grid-cols-3 gap-2"><div class="service-card bg-slate-800 rounded-lg p-3 border border-slate-600 cursor-pointer" onclick="openExternalService('downsub')"><h5 class="text-white text-xs">DownSub</h5></div><div class="service-card bg-slate-800 rounded-lg p-3 border border-slate-600 cursor-pointer" onclick="openExternalService('youtubetranscript')"><h5 class="text-white text-xs">YouTubeTranscript</h5></div><div class="service-card bg-slate-800 rounded-lg p-3 border border-slate-600 cursor-pointer" onclick="openExternalService('savesubs')"><h5 class="text-white text-xs">SaveSubs</h5></div></div></div></div>
                <div class="mb-6"><div class="flex items-center gap-2 mb-3"><span class="step-indicator bg-red-600 text-white">3</span><h4 class="text-sm font-medium text-red-400">ìœ íŠœë¸Œ ì§ì ‘ ë³µì‚¬</h4></div><div class="bg-slate-900 rounded-lg p-4 border border-slate-600"><button onclick="openYoutubeVideo()" class="w-full px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-lg">â–¶ï¸ ìœ íŠœë¸Œ ì—´ê¸°</button></div></div>
            </div>
            <div class="px-6 py-4 border-t border-slate-700 bg-slate-800/50"><button onclick="closeTranscriptModal()" class="w-full px-4 py-2 bg-slate-600 hover:bg-slate-700 text-white font-medium rounded-lg">ë‹«ê¸°</button></div>
        </div>
    </div>

    <div id="runModal" class="fixed inset-0 modal-overlay z-50 hidden flex items-center justify-center p-4">
        <div class="bg-slate-800 rounded-2xl border border-slate-700 max-w-md w-full overflow-hidden">
            <div class="p-6 text-center">
                <div class="text-5xl mb-4">âœ…</div>
                <h3 class="text-xl font-bold text-white mb-2">í”„ë¡¬í”„íŠ¸ ë³µì‚¬ ì™„ë£Œ!</h3>
                <p class="text-slate-400 mb-6">AI ì°½ì—ì„œ ë¶™ì—¬ë„£ê¸°(Ctrl+V) í•˜ì„¸ìš”.</p>
                <div class="flex gap-3"><button onclick="openAiNow()" id="openAiBtn" class="flex-1 px-4 py-3 claude-btn text-white font-bold rounded-lg">AI ì—´ê¸° â†’</button><button onclick="closeRunModal()" class="px-4 py-3 bg-slate-600 hover:bg-slate-700 text-white font-medium rounded-lg">ë‹«ê¸°</button></div>
            </div>
        </div>
    </div>
    
    <div id="resetModal" class="fixed inset-0 modal-overlay z-50 hidden flex items-center justify-center p-4">
        <div class="bg-slate-800 rounded-2xl border border-slate-700 max-w-sm w-full overflow-hidden">
            <div class="p-6 text-center">
                <div class="text-5xl mb-4">ğŸ”„</div>
                <h3 class="text-xl font-bold text-white mb-2">ì „ì²´ ë¦¬ì…‹</h3>
                <div class="flex gap-3"><button onclick="confirmReset()" class="flex-1 px-4 py-3 bg-red-600 hover:bg-red-700 text-white font-bold rounded-lg">ì´ˆê¸°í™”</button><button onclick="closeResetModal()" class="flex-1 px-4 py-3 bg-slate-600 hover:bg-slate-700 text-white font-medium rounded-lg">ì·¨ì†Œ</button></div>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ìƒíƒœ
        let currentAnalysisMode = 'auto';
        let currentFileFormat = 'html'; 
        let currentDocLayout = 'auto';
        let isGeminiMode = false;

        // "Silver" ìŠ¤íƒ€ì¼ CSS (ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€)
        const silverStyleCss = `body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:linear-gradient(135deg,#1a1a2e 0%,#16213e 100%);color:#e8e8e8;line-height:1.7;padding:16px;max-width:100%}.container{max-width:700px;margin:0 auto}header{text-align:center;padding:24px 0;border-bottom:2px solid #4a90d9;margin-bottom:24px}h1{font-size:1.6rem;color:#64b5f6;margin-bottom:8px}h2{font-size:1.3rem;color:#81d4fa;margin:32px 0 16px;padding-left:12px;border-left:4px solid #4fc3f7}h3{font-size:1.1rem;color:#b3e5fc;margin:20px 0 12px}p{margin-bottom:14px;color:#cfd8dc;text-align:justify}.highlight-box{background:linear-gradient(135deg,#1e3a5f 0%,#2d4a6f 100%);border-radius:12px;padding:20px;margin:20px 0;border-left:4px solid #4fc3f7;box-shadow:0 4px 6px rgba(0,0,0,0.2)}.warning-box{background:linear-gradient(135deg,#5d3a3a 0%,#6d4a4a 100%);border-radius:12px;padding:20px;margin:20px 0;border-left:4px solid #ef5350}.success-box{background:linear-gradient(135deg,#2e5d3a 0%,#3e6d4a 100%);border-radius:12px;padding:20px;margin:20px 0;border-left:4px solid #66bb6a}.key-point{color:#ffcc80;font-weight:700;background:rgba(255,204,128,0.1);padding:0 4px;border-radius:4px}.number{color:#4fc3f7;font-weight:700}.negative{color:#ef5350;font-weight:700}.positive{color:#66bb6a;font-weight:700}table{width:100%;border-collapse:collapse;margin:20px 0;font-size:0.95rem;background:rgba(255,255,255,0.03);border-radius:8px;overflow:hidden}th,td{padding:12px;text-align:center;border-bottom:1px solid #37474f}th{background:#263238;color:#81d4fa;font-weight:600}tr:hover{background:rgba(255,255,255,0.05)}.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:16px 0}.grid-item{background:rgba(255,255,255,0.05);border-radius:8px;padding:16px;text-align:center;border:1px solid rgba(255,255,255,0.1)}.grid-value{font-size:1.5rem;font-weight:700;color:#4fc3f7}.grid-label{font-size:0.85rem;color:#90a4ae}.summary-list{list-style:none;margin:16px 0;padding:0}.summary-list li{padding:10px 12px;margin-bottom:8px;background:rgba(255,255,255,0.05);border-radius:8px;display:flex;align-items:start}.summary-list li::before{content:'â–¸';color:#4fc3f7;margin-right:10px;font-weight:bold}footer{text-align:center;padding:32px 0;margin-top:40px;border-top:1px solid #37474f;color:#78909c;font-size:0.85rem}.chart-container{background:rgba(255,255,255,0.03);border-radius:12px;padding:20px;margin:20px 0}.bar-chart{display:flex;flex-direction:column;gap:12px}.bar-item{display:flex;align-items:center;gap:12px}.bar-label{width:100px;font-size:0.85rem;color:#90a4ae;text-align:right}.bar-container{flex:1;background:rgba(255,255,255,0.1);border-radius:4px;height:24px;overflow:hidden}.bar{height:100%;border-radius:4px;display:flex;align-items:center;justify-content:flex-end;padding-right:8px;font-size:0.75rem;font-weight:600}.bar-blue{background:linear-gradient(90deg,#1e88e5,#42a5f5)}.bar-green{background:linear-gradient(90deg,#43a047,#66bb6a)}.bar-orange{background:linear-gradient(90deg,#fb8c00,#ffa726)}.bar-red{background:linear-gradient(90deg,#e53935,#ef5350)}.timeline{position:relative;padding-left:30px;margin:20px 0}.timeline::before{content:'';position:absolute;left:8px;top:0;bottom:0;width:2px;background:#4fc3f7}.timeline-item{position:relative;margin-bottom:20px;padding-bottom:10px}.timeline-item::before{content:'';position:absolute;left:-26px;top:4px;width:12px;height:12px;border-radius:50%;background:#4fc3f7;border:2px solid #1a1a2e}.timeline-date{color:#4fc3f7;font-weight:600;font-size:0.9rem}.timeline-content{color:#cfd8dc;margin-top:4px}.pie-visual{display:flex;justify-content:center;gap:20px;flex-wrap:wrap;margin:20px 0}.pie-item{text-align:center;padding:15px;background:rgba(255,255,255,0.05);border-radius:8px;min-width:100px}.pie-percent{font-size:1.8rem;font-weight:700}.pie-label{font-size:0.8rem;color:#90a4ae;margin-top:4px}`;

        function getCurrentDate() {
            const now = new Date();
            return `${now.getFullYear()}ë…„ ${now.getMonth() + 1}ì›” ${now.getDate()}ì¼`;
        }

        // ì œë¯¸ë‚˜ì´ ëª¨ë“œ í† ê¸€
        document.getElementById('geminiToggle').addEventListener('change', function(e) {
            isGeminiMode = e.target.checked;
            updateUiForMode();
        });

        function updateUiForMode() {
            const runBtn = document.getElementById('runBtn');
            const openAiBtn = document.getElementById('openAiBtn');
            const geminiHint = document.getElementById('geminiHint');
            
            if (isGeminiMode) {
                runBtn.innerHTML = 'âœ¨ Geminiì—ì„œ ì „ì²´ ê¸°ë¡ ì‹¤í–‰';
                runBtn.className = 'w-full px-6 py-4 gemini-btn text-white font-bold rounded-xl transition-all text-lg flex items-center justify-center gap-2';
                openAiBtn.innerHTML = 'Gemini ì—´ê¸° â†’';
                openAiBtn.className = 'flex-1 px-4 py-3 gemini-btn text-white font-bold rounded-lg';
                geminiHint.classList.remove('hidden');
            } else {
                runBtn.innerHTML = 'ğŸš€ Claudeì—ì„œ ì „ì²´ ê¸°ë¡ ì‹¤í–‰';
                runBtn.className = 'w-full px-6 py-4 claude-btn text-white font-bold rounded-xl transition-all text-lg flex items-center justify-center gap-2';
                openAiBtn.innerHTML = 'Claude ì—´ê¸° â†’';
                openAiBtn.className = 'flex-1 px-4 py-3 claude-btn text-white font-bold rounded-lg';
                geminiHint.classList.add('hidden');
            }
        }

        function setAnalysisMode(mode) {
            currentAnalysisMode = mode;
            const buttons = { 'auto': 'modeAuto', 'finance': 'modeFinance', 'general': 'modeGeneral' };
            const colors = { 'auto': 'from-purple-600 to-blue-600 ring-purple-400', 'finance': 'from-green-600 to-emerald-600 ring-green-400', 'general': 'from-blue-600 to-cyan-600 ring-blue-400' };
            Object.keys(buttons).forEach(key => {
                const btn = document.getElementById(buttons[key]);
                if (key === mode) btn.className = `mode-btn px-3 py-2.5 bg-gradient-to-r ${colors[key]} text-white text-xs font-medium rounded-lg ring-2 ring-offset-2 ring-offset-slate-800`;
                else btn.className = 'mode-btn px-3 py-2.5 bg-slate-700 hover:bg-slate-600 text-white text-xs font-medium rounded-lg';
            });
        }

        function setFileFormat(format) {
            currentFileFormat = format;
            const formats = ['auto', 'docx', 'md', 'html'];
            const colors = { 'auto': {bg:'from-amber-600 to-orange-600', ring:'ring-amber-400'}, 'docx': {bg:'from-blue-600 to-blue-700', ring:'ring-blue-400'}, 'md': {bg:'from-slate-600 to-slate-700', ring:'ring-slate-400'}, 'html': {bg:'from-orange-600 to-red-600', ring:'ring-orange-400'} };
            
            formats.forEach(f => {
                const btn = document.getElementById('format' + f.charAt(0).toUpperCase() + f.slice(1));
                if (f === format) btn.className = `format-btn px-2 py-2 bg-gradient-to-r ${colors[f].bg} text-white text-xs font-medium rounded-lg ring-2 ${colors[f].ring} ring-offset-1 ring-offset-slate-800`;
                else btn.className = 'format-btn px-2 py-2 bg-slate-700 hover:bg-slate-600 text-white text-xs font-medium rounded-lg';
            });
        }

        function setDocLayout(layout) {
            currentDocLayout = layout;
            const layouts = ['auto', 'pc', 'mobile'];
            const colors = { 'auto': {bg:'from-teal-600 to-cyan-600', ring:'ring-teal-400'}, 'pc': {bg:'from-indigo-600 to-purple-600', ring:'ring-indigo-400'}, 'mobile': {bg:'from-pink-600 to-rose-600', ring:'ring-pink-400'} };
            layouts.forEach(l => {
                const btn = document.getElementById('layout' + l.charAt(0).toUpperCase() + l.slice(1));
                if (l === layout) btn.className = `layout-btn px-2 py-2 bg-gradient-to-r ${colors[l].bg} text-white text-xs font-medium rounded-lg ring-2 ${colors[l].ring} ring-offset-1 ring-offset-slate-800`;
                else btn.className = 'layout-btn px-2 py-2 bg-slate-700 hover:bg-slate-600 text-white text-xs font-medium rounded-lg';
            });
        }

        function extractVideoId(url) {
            const match = url.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/|shorts\/)([^&\n?#]+)/);
            return match ? match[1] : null;
        }

        async function fetchVideoTitle(url) {
            const loadingMsg = document.getElementById('loadingMsg');
            const errorMsg = document.getElementById('errorMsg');
            const successMsg = document.getElementById('successMsg');
            loadingMsg.classList.remove('hidden'); errorMsg.classList.add('hidden'); successMsg.classList.add('hidden');
            try {
                const response = await fetch(`https://www.youtube.com/oembed?url=${encodeURIComponent(url)}&format=json`);
                if (!response.ok) throw new Error();
                const data = await response.json();
                document.getElementById('videoTitle').value = data.title;
                successMsg.textContent = 'âœ… ì˜ìƒ ì •ë³´ ì™„ë£Œ!'; successMsg.classList.remove('hidden');
            } catch (err) {
                errorMsg.textContent = 'âš ï¸ ì œëª©ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì§ì ‘ ì…ë ¥í•´ì£¼ì„¸ìš”.'; errorMsg.classList.remove('hidden');
            } finally { loadingMsg.classList.add('hidden'); }
        }
        document.getElementById('youtubeUrl').addEventListener('input', function(e) { if (extractVideoId(e.target.value)) fetchVideoTitle(e.target.value); });

        function handleFileUpload(event) { if (event.target.files[0]) processFile(event.target.files[0]); }
        function handleModalFileUpload(event) { if (event.target.files[0]) { processFile(event.target.files[0]); closeTranscriptModal(); } }
        function processFile(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                let content = e.target.result;
                if (file.name.match(/\.(srt|vtt|sbv)$/i)) content = content.replace(/\d{2}:\d{2}.*$/gm, '').replace(/<[^>]+>/g, '');
                document.getElementById('transcript').value = content;
                document.getElementById('fileInfo').textContent = `âœ… "${file.name}" ë¡œë“œë¨`; document.getElementById('fileInfo').classList.remove('hidden');
                updateTranscriptInfo();
            };
            reader.readAsText(file);
        }
        function openTranscriptModal() { document.getElementById('transcriptModal').classList.remove('hidden'); }
        function closeTranscriptModal() { document.getElementById('transcriptModal').classList.add('hidden'); }
        function closeRunModal() { document.getElementById('runModal').classList.add('hidden'); }
        function openResetModal() { document.getElementById('resetModal').classList.remove('hidden'); }
        function closeResetModal() { document.getElementById('resetModal').classList.add('hidden'); }
        function openExternalService(service) {
            const url = document.getElementById('youtubeUrl').value; const vid = extractVideoId(url);
            const urls = { 'downsub': vid?`https://downsub.com/?url=${encodeURIComponent(url)}`:`https://downsub.com/`, 'youtubetranscript': vid?`https://youtubetranscript.com/?v=${vid}`:`https://youtubetranscript.com/`, 'savesubs': vid?`https://savesubs.com/process?url=${encodeURIComponent(url)}`:`https://savesubs.com/` };
            if(urls[service]) window.open(urls[service], '_blank');
        }
        function openYoutubeVideo() { window.open(document.getElementById('youtubeUrl').value || 'https://www.youtube.com/', '_blank'); }
        function clearTranscript() { document.getElementById('transcript').value = ''; document.getElementById('fileInfo').classList.add('hidden'); document.getElementById('transcriptInfo').textContent = ''; }
        function updateTranscriptInfo() { const t = document.getElementById('transcript').value; document.getElementById('transcriptInfo').textContent = `ê¸€ì ìˆ˜: ${t.length.toLocaleString()} | ë‹¨ì–´: ${t.trim()?t.trim().split(/\s+/).length.toLocaleString():0}`; }
        document.getElementById('transcript').addEventListener('input', updateTranscriptInfo);

        // ê²°ê³¼ì°½ ë¹„ìš°ê¸° ê¸°ëŠ¥ (UI ì—…ë°ì´íŠ¸ í¬í•¨)
        function clearOutput() {
            document.getElementById('output').value = '';
            document.getElementById('previewBadge').textContent = 'ëŒ€ê¸°ì¤‘';
            document.getElementById('previewBadge').classList.add('hidden');
            // í¬ì»¤ìŠ¤ë¥¼ ì£¼ì–´ ë°”ë¡œ ë¶™ì—¬ë„£ê¸° í¸í•˜ê²Œ
            document.getElementById('output').focus();
        }

        // ==========================================
        //  í”„ë¡¬í”„íŠ¸ ìƒì„± (Zero Summary / Full Record)
        // ==========================================
        function getPromptByMode(mode, videoTitle, youtubeUrl, transcript) {
            const header = `**Title:** ${videoTitle || '[ì˜ìƒ ì œëª©]'}\n**Link:** ${youtubeUrl || '[ìœ íŠœë¸Œ ë§í¬]'}\n**Date:** ${getCurrentDate()}\n\n---\n`;
            
            // HTML í¬ë§· ì„ íƒ ì‹œ 'Silver Style' CSS ì£¼ì…
            let visualGuide = "";
            if (currentFileFormat === 'html') {
                visualGuide = `
ğŸ¨ **HTML ìŠ¤íƒ€ì¼ë§ ì§€ì¹¨ (Silver Premium Style ì ìš©):**
1. **CSS ì ìš©:** ì•„ë˜ CSSë¥¼ <style> íƒœê·¸ì— ë°˜ë“œì‹œ í¬í•¨í•˜ì„¸ìš”.
\`\`\`css
${silverStyleCss}
\`\`\`
2. **í•„ìˆ˜ HTML êµ¬ì¡°:**
- **íƒ€ì„ë¼ì¸/ì—°í˜:** \`<div class="timeline"><div class="timeline-item">...\`
- **ë¹„ìœ¨(íŒŒì´) ì°¨íŠ¸:** \`<div class="pie-visual"><div class="pie-item"><div class="pie-percent">60%</div>...</div>\`
- **ë¹„êµ(ë°”) ì°¨íŠ¸:** \`<div class="bar-chart">...\`
- **í•µì‹¬ ë‚´ìš©:** \`<div class="highlight-box">...\`
- **ê²½ê³ /ë¦¬ìŠ¤í¬:** \`<div class="warning-box">...\`
- **ë°ì´í„° ê·¸ë¦¬ë“œ:** \`<div class="grid-2">...\`
`;
            } else {
                visualGuide = `ğŸ¨ **ì‹œê°í™”:** í…ìŠ¤íŠ¸ê°€ ì•„ë‹Œ 'í‘œ(Table)'ë¥¼ ì ê·¹ í™œìš©í•˜ì„¸ìš”.\n`;
            }

            let geminiSpecificInstruction = "";
            if (isGeminiMode) {
                geminiSpecificInstruction = `\nğŸ”¥ **Gemini ì „ìš© (ì˜ìƒ ì§ì ‘ ë¶„ì„):**\n1. ë§í¬ëœ ì˜ìƒì„ ì§ì ‘ ë³´ê³  ë¶„ì„í•˜ì„¸ìš”.\n2. í™”ë©´ì— ë‚˜ì˜¤ëŠ” ë„í‘œ/ì°¨íŠ¸ì˜ ìˆ˜ì¹˜ë¥¼ 100% í…ìŠ¤íŠ¸ë‚˜ í‘œë¡œ ë³€í™˜í•˜ì„¸ìš”.\n3. ê²°ê³¼ë¬¼ì€ ë°˜ë“œì‹œ 'ì½”ë“œ ë¸”ë¡' ì•ˆì— ì‘ì„±í•˜ì—¬ í•œ ë²ˆì— ë³µì‚¬í•  ìˆ˜ ìˆê²Œ í•´ì£¼ì„¸ìš”.\n`;
            }

            // ê·¹ë‹¨ì  ë¬´ì†ì‹¤ ê¸°ë¡ ì§€ì¹¨ (Zero Summary)
            const commonRequirements = `
ğŸš« **[ìµœìš°ì„  ì§€ì¹¨] ìš”ì•½ ê¸ˆì§€ & ì™„ì „í•œ ì¬êµ¬ì„± (NO SUMMARIZATION / FULL TRANSCRIPTION RECONSTRUCTION):**
1. **ëª©í‘œ:** 'ìš”ì•½'ì´ ì•„ë‹™ë‹ˆë‹¤. **'ì½ê¸° ì¢‹ê²Œ ë‹¤ë“¬ì€ ì „ì²´ ë…¹ì·¨ë¡(Full Structured Record)'**ì…ë‹ˆë‹¤.
2. **ë¶„ëŸ‰ ìœ ì§€:** ì…ë ¥ëœ ë‚´ìš©ì´ ê¸¸ë‹¤ë©´, ì¶œë ¥ ê²°ê³¼ë¬¼ë„ ê·¸ë§Œí¼ ê¸¸ì–´ì•¼ í•©ë‹ˆë‹¤. ë‚´ìš©ì„ ì¤„ì´ê±°ë‚˜ ìƒëµí•˜ë©´ ì‹¤íŒ¨í•œ ê²ƒìœ¼ë¡œ ê°„ì£¼í•©ë‹ˆë‹¤.
3. **ëª¨ë“  ë””í…Œì¼ í¬í•¨:**
   - í™”ìì˜ ëª¨ë“  ë†ë‹´, ì˜ˆì‹œ, ì‚¬ì†Œí•œ ë©˜íŠ¸, êµ¬ì²´ì ì¸ ìˆ˜ì¹˜, ë‚ ì§œë¥¼ í•˜ë‚˜ë„ ë¹ ëœ¨ë¦¬ì§€ ë§ê³  ê¸°ë¡í•˜ì„¸ìš”.
   - "ì—¬ëŸ¬ ì˜ˆì‹œë¥¼ ë“¤ì—ˆë‹¤"ë¼ê³  ë­‰ëš±ê·¸ë¦¬ì§€ ë§ê³ , ê·¸ ì˜ˆì‹œê°€ ë¬´ì—‡ì¸ì§€ ì „ë¶€ ì ìœ¼ì„¸ìš”.
4. **ë¬¸ì–´ì²´ ë³€í™˜:** ë§í•˜ëŠ” êµ¬ì–´ì²´ë¥¼ ê¹”ë”í•œ ë³´ê³ ì„œìš© ë¬¸ì–´ì²´ë¡œ ë°”ê¾¸ë˜, ì •ë³´ëŸ‰ì€ 100% ìœ ì§€í•˜ì„¸ìš”.
5. **êµ¬ì¡°í™”:** ê¸´ ì¤„ê¸€ ëŒ€ì‹  ì†Œì œëª©, ë¶ˆë › í¬ì¸íŠ¸, í‘œ, ë°•ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ê°€ë…ì„±ì„ ë†’ì´ë˜, ë‚´ìš©ì€ ê½‰ ì±„ìš°ì„¸ìš”.
---
`;
            let contentPart = transcript.trim() ? `## ğŸ“ ì›ë³¸ ë‚´ìš© (ì „ì²´ ë¶„ì„ ëŒ€ìƒ)\n${transcript}\n---` : (isGeminiMode ? `## ğŸ“ ì˜ìƒ ì†ŒìŠ¤\n(ìë§‰ ì—†ìŒ. Gemini ì˜ìƒ ë¶„ì„ ê¸°ëŠ¥ ì‚¬ìš©. ì˜ìƒì˜ ëª¨ë“  ë©˜íŠ¸ì™€ í™”ë©´ ì •ë³´ë¥¼ ë¹ ì§ì—†ì´ ê¸°ë¡í•˜ì„¸ìš”.)\n---` : `## ğŸ“ ìë§‰ ì—†ìŒ\n---`);
            
            let modeInstruction = "";
            if (mode === 'finance') {
                modeInstruction = `ğŸ“ˆ **ëª¨ë“œ: ê²½ì œ/íˆ¬ì ì „ì²´ ê¸°ë¡**\n- ì–¸ê¸‰ëœ ëª¨ë“  ì¢…ëª©, ê°€ê²©, ìˆ˜ì¹˜, ë“±ë½ë¥ ì„ í‘œë¡œ ë§Œë“œì„¸ìš”.\n- íˆ¬ì ê·¼ê±°ì™€ ë¦¬ìŠ¤í¬ ìš”ì¸ì„ ë¹ ì§ì—†ì´ ë‚˜ì—´í•˜ì„¸ìš”.`;
            } else if (mode === 'general') {
                modeInstruction = `ğŸ“š **ëª¨ë“œ: ì¼ë°˜ ì§€ì‹ ì „ì²´ ê¸°ë¡**\n- ê°•ì˜ë‚˜ ì„¤ëª…ì˜ ëª¨ë“  ë‹¨ê³„ë¥¼ í•˜ë‚˜ë„ ê±´ë„ˆë›°ì§€ ë§ê³  ìƒì„¸íˆ ì„œìˆ í•˜ì„¸ìš”.`;
            } else {
                modeInstruction = `ğŸ¤– **ëª¨ë“œ: ì „ì²´ ê¸°ë¡ (ìë™)**\n- ì£¼ì œì— ìƒê´€ì—†ì´ ì •ë³´ì˜ ëˆ„ë½ì´ ì—†ëŠ” ì™„ë²½í•œ ê¸°ë¡ë¬¼ì„ ì‘ì„±í•˜ì„¸ìš”.`;
            }

            return header + geminiSpecificInstruction + visualGuide + "\n" + modeInstruction + "\n" + commonRequirements + "\n" + contentPart;
        }

        // ì‹¤í–‰/ë³µì‚¬ ë¡œì§
        function buildDocumentContent() {
            const t = document.getElementById('transcript').value;
            const u = document.getElementById('youtubeUrl').value;
            if (!t.trim() && !isGeminiMode) { document.getElementById('errorMsg').textContent = 'âš ï¸ ìë§‰ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'; document.getElementById('errorMsg').classList.remove('hidden'); return null; }
            if (!u && isGeminiMode && !t.trim()) { document.getElementById('errorMsg').textContent = 'âš ï¸ Gemini ëª¨ë“œëŠ” ë§í¬ í•„ìˆ˜.'; document.getElementById('errorMsg').classList.remove('hidden'); return null; }
            document.getElementById('errorMsg').classList.add('hidden');
            return getPromptByMode(currentAnalysisMode, document.getElementById('videoTitle').value, u, t);
        }

        async function runAnalysis() {
            const c = buildDocumentContent(); if (!c) return;
            document.getElementById('output').value = c;
            try { await navigator.clipboard.writeText(c); } catch(e) { document.getElementById('output').select(); document.execCommand('copy'); }
            document.getElementById('previewBadge').textContent = 'ë³µì‚¬ë¨';
            document.getElementById('previewBadge').classList.remove('hidden');
            document.getElementById('runModal').classList.remove('hidden');
        }

        function downloadHtml() {
            const content = document.getElementById('output').value;
            if (!content || !content.includes('<html')) { alert('âš ï¸ ë¨¼ì € AIê°€ ìƒì„±í•œ HTML ì½”ë“œë¥¼ ì•„ë˜ í…ìŠ¤íŠ¸ ì˜ì—­ì— ë¶™ì—¬ë„£ì–´ì£¼ì„¸ìš”.'); return; }
            const blob = new Blob([content], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = `report_${new Date().toISOString().slice(0,10)}.html`;
            document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);
        }

        function previewHtml() {
            const content = document.getElementById('output').value;
            if (!content || !content.includes('<html')) { alert('âš ï¸ ë¨¼ì € AIê°€ ìƒì„±í•œ HTML ì½”ë“œë¥¼ ì•„ë˜ í…ìŠ¤íŠ¸ ì˜ì—­ì— ë¶™ì—¬ë„£ì–´ì£¼ì„¸ìš”.'); return; }
            const newWindow = window.open(); newWindow.document.write(content); newWindow.document.close();
        }

        function openAiNow() { window.open(isGeminiMode?'https://gemini.google.com/':'https://claude.ai/new', '_blank'); closeRunModal(); }
        function confirmReset() { location.reload(); }
        
        // Modal Event Listeners
        document.addEventListener('keydown', function(e) { if (e.key === 'Escape') { closeTranscriptModal(); closeRunModal(); closeResetModal(); } });
        document.getElementById('transcriptModal').addEventListener('click', function(e) { if (e.target === this) closeTranscriptModal(); });
        document.getElementById('runModal').addEventListener('click', function(e) { if (e.target === this) closeRunModal(); });
        document.getElementById('resetModal').addEventListener('click', function(e) { if (e.target === this) closeResetModal(); });
    </script>
</body>
</html>